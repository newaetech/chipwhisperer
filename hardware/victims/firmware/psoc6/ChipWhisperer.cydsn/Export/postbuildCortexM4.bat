@REM This script allows a 3rd party IDE to use cymcuelftool.exe to perform
@REM the post processing that is necessary to update the *.elf file
@REM generated by the linker into a complete memory image to use in
@REM programming the PSoC.
@REM NOTE: This script is auto generated. Do not modify.
IF /I "%~4" NEQ "cmsis" GOTO not_cmsis
copy /Y "%~5\cymcuelftool.exe" "%~3\cymcuelftool.exe"
@IF %errorlevel% NEQ 0 EXIT /b %errorlevel%
move /Y "%~1" "%~dp1\%~n1_link.axf"
@IF %errorlevel% NEQ 0 EXIT /b %errorlevel%
@setlocal enabledelayedexpansion
@set CurrentLinkFile="%~dp1\%~n1_link.axf"
@set SignedLinkFile="%~dp1\%~n1_signed.axf"
@set MergeFiles=%SignedLinkFile%

@REM If you have changed the CortexM0p-based project executable output directory, then please provide your location here:
@set CORTEXM0P_OUTPUT_DIRECTORY=%~3\Objects

for %%i in ("%CORTEXM0P_OUTPUT_DIRECTORY%\*_link.axf") do @(
IF "%%i" NEQ "%~dp1\%~n1_link.axf" set MergeFiles=!MergeFiles! "%%i"
)
set MergeFiles=%MergeFiles:_link=%
"%~3\cymcuelftool.exe" --sign %CurrentLinkFile% --output %SignedLinkFile%
@IF %errorlevel% NEQ 0 EXIT /b %errorlevel%
"%~3\cymcuelftool.exe" --merge %MergeFiles% --output "%~1"
@IF %errorlevel% NEQ 0 EXIT /b %errorlevel%
EXIT

:not_cmsis
IF /I "%~2" NEQ "eclipse" GOTO not_eclipse
move /y "%~1" "%~n1_link.out"
@IF %errorlevel% NEQ 0 EXIT /b %errorlevel%
@setlocal enabledelayedexpansion
@set CurrentLinkFile="%~n1_link.out"
@set SignedLinkFile="%~n1_signed.out"
@set MergeFiles="%~n1_signed.out" "%~3"
.\cymcuelftool.exe --sign %CurrentLinkFile% --output %SignedLinkFile%
@IF %errorlevel% NEQ 0 EXIT /b %errorlevel%
.\cymcuelftool.exe --merge %MergeFiles% --output "%~1"
@IF %errorlevel% NEQ 0 EXIT /b %errorlevel%
EXIT

:not_eclipse
